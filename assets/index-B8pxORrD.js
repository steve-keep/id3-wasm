(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))u(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const n of t.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&u(n)}).observe(document,{childList:!0,subtree:!0});function d(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function u(e){if(e.ep)return;e.ep=!0;const t=d(e);fetch(e.href,t)}})();const L=document.getElementById("start-button"),a=document.getElementById("timing-output"),O=document.getElementById("worker-count-output"),P=document.querySelector("#metadata-table tbody");L.addEventListener("click",async()=>{if(!window.showDirectoryPicker){alert("File System Access API is not supported in this browser.");return}try{const i=await window.showDirectoryPicker();a.textContent="Collecting files...",P.innerHTML="";const r=[];for await(const s of i.values())s.kind==="file"&&s.name.endsWith(".mp3")&&r.push(await s.getFile());const d=navigator.hardwareConcurrency||4;O.textContent=`Using ${d} workers.`,a.textContent="Starting processing...";const u=performance.now();let e=0,t=0;const n=[...r],g=[];await new Promise(s=>{const C=()=>{t--,t===0&&n.length===0&&s()},p=m=>{if(n.length>0){const o=n.shift();t++,m.postMessage({type:"process",payload:{file:o,HEAD_CHUNK_SIZE:4096}})}};for(let m=0;m<d;m++){const o=new Worker(new URL("/id3-wasm/assets/worker-Cfsyw6WS.js",import.meta.url));g.push(o),o.onmessage=f=>{const{type:y,payload:h}=f.data;if(y==="ready"){p(o);return}if(e++,y==="result"){const{metadata:l}=h,c=document.createElement("tr"),w=document.createElement("td");w.textContent=l.title,c.appendChild(w);const E=document.createElement("td");E.textContent=l.artist,c.appendChild(E);const x=document.createElement("td");x.textContent=l.album,c.appendChild(x);const b=document.createElement("td");b.textContent=l.year,c.appendChild(b);const k=document.createElement("td");k.textContent=l.genre,c.appendChild(k),P.appendChild(c)}else y==="error"&&console.error(h);a.textContent=`Scanning... Processed ${e} of ${r.length} files.`,C(),p(o)},o.onerror=f=>{console.error("Worker error:",f),e++,C(),p(o)}}}),g.forEach(s=>s.terminate());const F=(performance.now()-u)/1e3;a.textContent=`Scanned ${r.length} files in ${F.toFixed(2)} seconds.`}catch(i){i.name!=="AbortError"&&(console.error("Error selecting directory:",i),a.textContent=`Error: ${i.message}`)}});
